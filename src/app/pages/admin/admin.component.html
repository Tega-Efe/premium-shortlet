<div class="admin-page">
      <!-- Admin Header -->
      <div class="admin-header">
        <div class="header-background">
          <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
            <path fill="rgba(212, 165, 116, 0.15)" d="M0,192 Q360,128 720,192 T1440,192 L1440,0 L0,0 Z"></path>
            <path fill="rgba(125, 25, 53, 0.1)" d="M0,160 Q360,96 720,160 T1440,160 L1440,0 L0,0 Z"></path>
          </svg>
        </div>
        <div class="container" appAnimateOnScroll="slide-up">
          <div class="header-content">
            <div class="header-badge">
              <i class="fas fa-shield-alt"></i>
              <span>Admin Portal</span>
            </div>
            <h1 class="page-title">
              <i class="fas fa-th-large"></i>
              Dashboard
            </h1>
            <p class="page-subtitle">Manage bookings, approvals, and monitor platform activity</p>
          </div>
        </div>
      </div>

      <div class="container">
        <!-- Dashboard Stats -->
        <div class="stats-grid">
          <div class="stat-card" appAnimateOnScroll="slide-up" [delay]="0">
            <div class="stat-icon burgundy">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
              <p class="stat-label">Total Bookings</p>
              <p class="stat-value">{{ stats().totalBookings }}</p>
              <div class="stat-trend positive">
                <i class="fas fa-arrow-up"></i>
                <span>12% this month</span>
              </div>
            </div>
          </div>

          <div class="stat-card" appAnimateOnScroll="slide-up" [delay]="100">
            <div class="stat-icon gold">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <p class="stat-label">Pending Approvals</p>
              <p class="stat-value">{{ stats().pendingApprovals }}</p>
              <div class="stat-trend">
                <i class="fas fa-hourglass-half"></i>
                <span>Needs attention</span>
              </div>
            </div>
          </div>

          <div class="stat-card" appAnimateOnScroll="slide-up" [delay]="200">
            <div class="stat-icon success">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <p class="stat-label">Approved Today</p>
              <p class="stat-value">{{ stats().approvedToday }}</p>
              <div class="stat-trend positive">
                <i class="fas fa-thumbs-up"></i>
                <span>Great progress!</span>
              </div>
            </div>
          </div>

          <div class="stat-card" appAnimateOnScroll="slide-up" [delay]="300">
            <div class="stat-icon danger">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-content">
              <p class="stat-label">Rejected Today</p>
              <p class="stat-value">{{ stats().rejectedToday }}</p>
              <div class="stat-trend">
                <i class="fas fa-ban"></i>
                <span>Reviewed cases</span>
              </div>
            </div>
          </div>
        </div>

        <!-- NEW: Apartment Availability Control (Single-Apartment Mode) -->
        <div class="availability-control-card" appAnimateOnScroll="slide-up" [delay]="400">
          <div class="availability-header">
            <div class="availability-info">
              <h3 class="availability-title">
                <i class="fas fa-home"></i>
                Apartment Availability
              </h3>
              <p class="availability-description">
                Control whether guests can book the apartment. When unavailable, the booking form will be hidden from the homepage.
              </p>
            </div>
            <div class="availability-status" [class.available]="isApartmentAvailable()" [class.unavailable]="!isApartmentAvailable()">
              <span class="status-indicator"></span>
              <span class="status-text">{{ isApartmentAvailable() ? 'Available' : 'Unavailable' }}</span>
            </div>
          </div>
          <div class="availability-actions">
            <button 
              class="btn-toggle-availability"
              [class.make-unavailable]="isApartmentAvailable()"
              [class.make-available]="!isApartmentAvailable()"
              [disabled]="isTogglingAvailability()"
              (click)="toggleApartmentAvailability()"
            >
              @if (isTogglingAvailability()) {
                <i class="fas fa-spinner fa-spin"></i>
                <span>Updating...</span>
              } @else if (isApartmentAvailable()) {
                <i class="fas fa-ban"></i>
                <span>Mark as Unavailable</span>
              } @else {
                <i class="fas fa-check-circle"></i>
                <span>Mark as Available</span>
              }
            </button>
            <p class="availability-hint">
              <i class="fas fa-info-circle"></i>
              {{ isApartmentAvailable() 
                ? 'Guests can currently book the apartment' 
                : 'Booking form is hidden on the homepage' }}
            </p>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container" appAnimateOnScroll="fade-in">
          <div class="tabs">
            <button 
              class="tab"
              [class.active]="activeTab() === 'pending'"
              (click)="setActiveTab('pending')"
            >
              <i class="fas fa-clock"></i>
              <span>Pending Approvals</span>
              @if (pendingBookings().length > 0) {
                <span class="tab-badge">{{ pendingBookings().length }}</span>
              }
            </button>
            <button 
              class="tab"
              [class.active]="activeTab() === 'all'"
              (click)="setActiveTab('all')"
            >
              <i class="fas fa-list"></i>
              <span>All Bookings</span>
            </button>
            <button 
              class="tab"
              [class.active]="activeTab() === 'history'"
              (click)="setActiveTab('history')"
            >
              <i class="fas fa-history"></i>
              <span>Activity History</span>
            </button>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Loading State -->
          @if (isLoading()) {
            <div class="loading-container">
              <app-loader />
            </div>
          }

          <!-- Pending Approvals Tab -->
          @else if (activeTab() === 'pending') {
            @if (pendingBookings().length > 0) {
              <div class="table-wrapper">
                <div class="table-header">
                  <h3 class="table-title">
                    <i class="fas fa-clipboard-list"></i>
                    Pending Approval Requests
                  </h3>
                  <p class="table-subtitle">Review and approve or reject booking requests</p>
                </div>
                <div class="table-container">
                  <table class="bookings-table">
                    <thead>
                      <tr>
                        <th><i class="fas fa-hashtag"></i> ID</th>
                        <th><i class="fas fa-user"></i> Guest Name</th>
                        <th><i class="fas fa-home"></i> Apartment</th>
                        <th><i class="fas fa-calendar"></i> Check-in</th>
                        <th><i class="fas fa-calendar-alt"></i> Check-out</th>
                        <th><i class="fas fa-users"></i> Guests</th>
                        <th><i class="fas fa-dollar-sign"></i> Total</th>
                        <th><i class="fas fa-cog"></i> Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (booking of pendingBookings(); track booking.id) {
                        <tr class="table-row">
                          <td>
                            <span class="booking-id">{{ booking.id?.slice(0, 8) || 'N/A' }}</span>
                          </td>
                          <td>
                            <div class="guest-cell">
                              <div class="guest-avatar">
                                <i class="fas fa-user-circle"></i>
                              </div>
                              <div class="guest-info">
                                <span class="guest-name">{{ booking.guestInfo.name }}</span>
                                <span class="guest-email">{{ booking.guestInfo.email }}</span>
                              </div>
                            </div>
                          </td>
                          <td>
                            <span class="apartment-title">{{ booking.apartmentTitle }}</span>
                          </td>
                          <td>{{ booking.bookingDetails.checkIn | date:'MMM d, y' }}</td>
                          <td>{{ booking.bookingDetails.checkOut | date:'MMM d, y' }}</td>
                          <td>
                            <span class="guest-count">
                              <i class="fas fa-user"></i>
                              {{ booking.bookingDetails.numberOfGuests }}
                            </span>
                          </td>
                          <td>
                            <span class="price-cell">
                              {{ booking.pricing.currency }} {{ booking.pricing.totalPrice | number:'1.2-2' }}
                            </span>
                          </td>
                          <td>
                            <div class="action-buttons">
                              <button 
                                class="btn btn-sm btn-success"
                                (click)="openApprovalModal(booking, 'approve')"
                              >
                                <i class="fas fa-check"></i>
                                Approve
                              </button>
                              <button 
                                class="btn btn-sm btn-danger"
                                (click)="openApprovalModal(booking, 'reject')"
                              >
                                <i class="fas fa-times"></i>
                                Reject
                              </button>
                            </div>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            } @else {
              <div class="empty-state">
                <div class="empty-icon success">
                  <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="empty-title">All Caught Up!</h3>
                <p class="empty-text">There are no pending approvals at the moment. Great job!</p>
              </div>
            }
          }

          <!-- All Bookings Tab -->
          @else if (activeTab() === 'all') {
            @if (allBookings().length > 0) {
              <div class="table-wrapper">
                <div class="table-header">
                  <h3 class="table-title">
                    <i class="fas fa-list-alt"></i>
                    All Bookings
                  </h3>
                  <p class="table-subtitle">Complete list of all booking requests and their current status</p>
                </div>
                <div class="table-container">
                  <table class="bookings-table">
                    <thead>
                      <tr>
                        <th><i class="fas fa-hashtag"></i> ID</th>
                        <th><i class="fas fa-user"></i> Guest</th>
                        <th><i class="fas fa-home"></i> Apartment</th>
                        <th><i class="fas fa-calendar"></i> Check-in</th>
                        <th><i class="fas fa-info-circle"></i> Status</th>
                        <th><i class="fas fa-dollar-sign"></i> Total</th>
                        <th><i class="fas fa-cog"></i> Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      @for (booking of allBookings(); track booking.id) {
                        <tr class="table-row">
                          <td>
                            <span class="booking-id">{{ booking.id?.slice(0, 8) || 'N/A' }}</span>
                          </td>
                          <td>
                            <div class="guest-cell">
                              <div class="guest-avatar">
                                <i class="fas fa-user-circle"></i>
                              </div>
                              <div class="guest-info">
                                <span class="guest-name">{{ booking.guestInfo.name }}</span>
                              </div>
                            </div>
                          </td>
                          <td>
                            <span class="apartment-title">{{ booking.apartmentTitle }}</span>
                          </td>
                          <td>{{ booking.bookingDetails.checkIn | date:'MMM d, y' }}</td>
                          <td>
                            <span 
                              class="status-badge"
                              [class]="'status-' + booking.status"
                            >
                              <i [class]="getStatusIcon(booking.status)"></i>
                              {{ booking.status }}
                            </span>
                          </td>
                          <td>
                            <span class="price-cell">
                              {{ booking.pricing.currency }} {{ booking.pricing.totalPrice | number:'1.2-2' }}
                            </span>
                          </td>
                          <td>
                            <button 
                              class="btn btn-sm btn-outline"
                              (click)="viewBookingDetails(booking)"
                            >
                              <i class="fas fa-eye"></i>
                              View
                            </button>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            } @else {
              <div class="empty-state">
                <div class="empty-icon info">
                  <i class="fas fa-inbox"></i>
                </div>
                <h3 class="empty-title">No Bookings Yet</h3>
                <p class="empty-text">There are no bookings in the system. Check back later.</p>
              </div>
            }
          }

          <!-- Activity History Tab -->
          @else if (activeTab() === 'history') {
            @if (adminActions().length > 0) {
              <div class="activity-wrapper">
                <div class="activity-header">
                  <h3 class="activity-title">
                    <i class="fas fa-history"></i>
                    Recent Activity
                  </h3>
                  <p class="activity-subtitle">Track all administrative actions and changes</p>
                </div>
                <div class="activity-list">
                  @for (action of adminActions(); track action.id; let i = $index) {
                    <div class="activity-item" appAnimateOnScroll="slide-right" [delay]="i * 50">
                      <div class="activity-timeline">
                        <div class="timeline-dot" [class]="'dot-' + action.action"></div>
                        <div class="timeline-line"></div>
                      </div>
                      <div class="activity-card">
                        <div class="activity-icon-badge" [class]="'badge-' + action.action">
                          <i [class]="getActionIconClass(action.action)"></i>
                        </div>
                        <div class="activity-content">
                          <p class="activity-action-title">
                            {{ getActionDescription(action) }}
                          </p>
                          <div class="activity-meta">
                            <span class="meta-item">
                              <i class="fas fa-user-shield"></i>
                              {{ action.adminName }}
                            </span>
                            <span class="meta-divider">â€¢</span>
                            <span class="meta-item">
                              <i class="fas fa-clock"></i>
                              {{ action.timestamp | date:'MMM d, y - h:mm a' }}
                            </span>
                          </div>
                          @if (action.details.notes) {
                            <div class="activity-notes">
                              <i class="fas fa-sticky-note"></i>
                              {{ action.details.notes }}
                            </div>
                          }
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>
            } @else {
              <div class="empty-state">
                <div class="empty-icon info">
                  <i class="fas fa-clipboard-list"></i>
                </div>
                <h3 class="empty-title">No Activity Yet</h3>
                <p class="empty-text">There is no activity history to display. Actions will appear here once performed.</p>
              </div>
            }
          }
        </div>
      </div>

      <!-- Approval Modal -->
      <app-modal
        #approvalModal
        [size]="'md'"
        [showFooter]="true"
        [showDefaultButtons]="true"
        [confirmText]="approvalAction() === 'approve' ? 'Approve' : 'Reject'"
        (modalClose)="closeApprovalModal()"
        (modalConfirm)="confirmApproval()"
      >
        @if (selectedBooking()) {
          <div class="approval-content">
            <p class="approval-question">
              Are you sure you want to {{ approvalAction() }} this booking?
            </p>
            
            <div class="booking-details">
              <div class="detail-row">
                <span class="detail-label">Guest:</span>
                <span class="detail-value">{{ selectedBooking()!.guestInfo.name }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Apartment:</span>
                <span class="detail-value">{{ selectedBooking()!.apartmentTitle }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Check-in:</span>
                <span class="detail-value">{{ selectedBooking()!.bookingDetails.checkIn | date }}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Total:</span>
                <span class="detail-value">
                  {{ selectedBooking()!.pricing.currency }} {{ selectedBooking()!.pricing.totalPrice | number }}
                </span>
              </div>
            </div>

            @if (approvalAction() === 'reject') {
              <div class="form-group">
                <label for="reason" class="form-label">Reason for rejection:</label>
                <textarea
                  id="reason"
                  name="rejectionReason"
                  [(ngModel)]="rejectionReason"
                  class="form-control"
                  rows="3"
                  placeholder="Enter reason for rejection..."
                ></textarea>
              </div>
            }
          </div>
        }
      </app-modal>

      <!-- Booking Details Modal -->
      <app-modal
        #detailsModal
        [size]="'lg'"
        (modalClose)="closeDetailsModal()"
      >
        @if (selectedBooking()) {
          <div class="details-content">
            <h3 class="details-heading">Guest Information</h3>
            <div class="details-grid">
              <div class="detail-item">
                <span class="detail-label">Name:</span>
                <span class="detail-value">{{ selectedBooking()!.guestInfo.name }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Email:</span>
                <span class="detail-value">{{ selectedBooking()!.guestInfo.email }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Phone:</span>
                <span class="detail-value">{{ selectedBooking()!.guestInfo.phone }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Number of Guests:</span>
                <span class="detail-value">{{ selectedBooking()!.guestInfo.numberOfGuests }}</span>
              </div>
            </div>

            <h3 class="details-heading">Booking Information</h3>
            <div class="details-grid">
              <div class="detail-item">
                <span class="detail-label">Apartment:</span>
                <span class="detail-value">{{ selectedBooking()!.apartmentTitle }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Check-in:</span>
                <span class="detail-value">{{ selectedBooking()!.bookingDetails.checkIn | date }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Check-out:</span>
                <span class="detail-value">{{ selectedBooking()!.bookingDetails.checkOut | date }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Nights:</span>
                <span class="detail-value">{{ selectedBooking()!.bookingDetails.numberOfNights }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Status:</span>
                <span class="status-badge" [class]="'status-' + selectedBooking()!.status">
                  {{ selectedBooking()!.status }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Total Price:</span>
                <span class="detail-value">
                  {{ selectedBooking()!.pricing.currency }} {{ selectedBooking()!.pricing.totalPrice | number }}
                </span>
              </div>
            </div>

            @if (selectedBooking()!.specialRequests) {
              <h3 class="details-heading">Special Requests</h3>
              <p class="special-requests">{{ selectedBooking()!.specialRequests }}</p>
            }
          </div>
        }
      </app-modal>
    </div>
